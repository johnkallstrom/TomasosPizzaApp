@inject IUserService UserService
@inject ICartService CartService
@model CheckoutViewModel

@{
    ViewData["Title"] = "Kassa";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<section id="checkout">
    <div class="container">
        <!-- CART -->
        <div id="items">
            <h1>Din beställning</h1>
            <hr />
            <ul>
                @foreach (var item in Model.Items)
                {
                    <div class="wrapper">
                        <li class="name">
                            <div id="counter">
                                <span class="counter-value">Antal: @item.ItemCount</span>
                            </div>
                            @item.ItemName
                            <span class="price">@item.ItemTotal kr</span>
                        </li>
                    </div>
                }
            </ul>

            <div id="calculation">
                <hr />
                <!-- PREMIUM USER -->
                @if (await UserService.IsUserPremium(Model.User) == true)
                {
                    <p>Din nuvarande bonus: @Model.Kund.BonusPoints poäng</p>

                    @if (CartService.HasPointsForFreeDish(Model.Kund) == true)
                    {
                        <p>Grattis!</p>
                        <p>Du har tjänat ihop 100 bonuspoäng så därför bjuder vi dig på en maträtt.</p>
                    }

                    <p>Antal bonuspoäng för den här beställningen: @Model.BonusPoints poäng</p>
                    <p>Total: @Model.Total kr</p>
                    <p>Bonusrabatt: -@CartService.GetBonusDiscount() kr</p>
                    <p>Premiumrabatt: -@CartService.GetPremiumDiscount() kr</p>
                    <h3 class="total">Total (inkl. rabatter): @CartService.FetchDiscountCartTotal(Model.Kund) kr</h3>
                }
                else
                {
                    <h3 class="total">Total: @Model.Total kr</h3>
                }
            </div>
        </div>

        <!-- FORM -->
        <div id="details">
            <form asp-controller="Order" asp-action="Checkout" method="post">
                <div class="header">
                    <h1>Dina uppgifter</h1>
                </div>

                @if (await UserService.IsUserPremium(Model.User) == true)
                {
                    <div class="form-group">
                        <input type="hidden" asp-for="Kund.BonusPoints" />
                    </div>
                }

                <div class="form-group">
                    <span asp-validation-for="Kund.Namn"></span>
                    <input type="text" asp-for="Kund.Namn" maxlength="100" placeholder="Namn" readonly />
                </div>

                <div class="form-group">
                    <span asp-validation-for="Kund.Email"></span>
                    <input type="text" asp-for="Kund.Email" maxlength="50" placeholder="Email" readonly />
                </div>

                <div class="form-group">
                    <span asp-validation-for="Kund.Gatuadress"></span>
                    <input type="text" asp-for="Kund.Gatuadress" maxlength="50" placeholder="Adress" readonly />
                </div>

                <div class="form-group">
                    <span asp-validation-for="Kund.Postnr"></span>
                    <input type="text" asp-for="Kund.Postnr" maxlength="20" placeholder="Postnummer" readonly />
                </div>

                <div class="form-group">
                    <span asp-validation-for="Kund.Postort"></span>
                    <input type="text" asp-for="Kund.Postort" maxlength="100" placeholder="Postort" readonly />
                </div>

                <div class="form-group">
                    <span asp-validation-for="Kund.Telefon"></span>
                    <input type="text" asp-for="Kund.Telefon" maxlength="50" placeholder="Telefon" readonly />
                </div>

                <!-- Hidden ID -->
                <input type="hidden" asp-for="Kund.KundId" />

                <div class="button-group">
                    <input type="submit" value="Slutför köp" class="button" />
                </div>
            </form>
        </div>
    </div>
</section>